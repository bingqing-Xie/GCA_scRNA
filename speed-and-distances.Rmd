---
title: "gca_main"
knit: (function(input_file, encoding) {
    out_dir <- 'docs';
    rmarkdown::render(input_file,
      encoding=encoding,
      output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Bingqing Xie"
date: "8/21/2022"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(monocle)
library(knitr)
library(ggplot2)
library(patchwork)

stem <- c( "LGR5", "ASCL2", "SMOC2", "RGMB", "OLFM4")
goblet <- c("CLCA1", "SPDEF", "FCGBP", "ZG16", "MUC2")

ec_markers=c("SLC12A2","OLFM4","APOC3","APOA4","APOA1","FABP6","FABP2","ANPEP","RBP2","ALDOB","DPEP1","HLA-DRB1","HLA-DRA","GSTA2","GSTA1","DMBT1","REG1A")

goblet_markers=c("FFAR4","CD177","BEST2","KLK1","FCGBP","TFF1","ZG16","WFDC2","RETNLB","SPDEF","REG4","MUC2","TFF3","CLCA1","SPINK4","ITLN1")

plotMonocleResults=function(monoObj,type="absorptive",cells="all"){
    plist=list()
    plist[['anno1']]=plot_cell_trajectory(monoObj,col="State",show_branch_points = TRUE,cell_size = 0.4,state_number_size = 1)+facet_wrap(~anno1)+ggtitle("Anno1")
    plist[['anno2']]=plot_cell_trajectory(monoObj,col="State",show_branch_points = TRUE,cell_size = 0.4,state_number_size = 1)+facet_wrap(~anno2)+ggtitle("Anno2")
    meta = pData(monoObj)
    #kable(table(meta$anno2,meta$State),caption="anno2 and State")
    plist[['anno1_v']]=ggplot(meta,aes(y=anno1,x=Pseudotime,color=State)) + geom_violin(orientation='y') + geom_jitter()+ggtitle("Anno1")
    plist[['anno2_v']]=ggplot(meta,aes(y=anno2,x=Pseudotime,color=State))+ geom_violin(orientation='y') + geom_jitter()+ggtitle("Anno2")
    plist[['inf_status']]=ggplot(meta,aes(y=inflammation_status,x=Pseudotime,color=State))+ geom_violin(orientation='y') + geom_jitter()+ggtitle("Inf status")
    plist[['stem']]=plot_cell_trajectory(monoObj, markers = stem, use_color_gradient = TRUE,cell_size=0.4,state_number_size=0.5)+ggtitle("Stem markers")
      plist[['ec']]=plot_cell_trajectory(monoObj, markers = ec_markers, use_color_gradient = TRUE,cell_size=0.4,state_number_size=0.5)+ggtitle("EC markers")
      plist[['goblet']]=plot_cell_trajectory(monoObj, markers = goblet, use_color_gradient = TRUE,cell_size=0.4,state_number_size=0.5)+ggtitle("Goblet celltype markers")
      plist[['goblet1']]=plot_cell_trajectory(monoObj, markers = goblet_markers, use_color_gradient = TRUE,cell_size=0.4,state_number_size=0.5)+ggtitle("Goblet additional markers")
    return(plist)
}
```



# Trajectory {.tabset}

## Absorptive {.tabset}

### All cells {.tabset}

```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Aborptive/TI_epi_reclustered_1.5Healthy_adjacent_no_yesorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']]  
plist[['inf_status']]
plist[['stem']]+plist[['ec']]
meta = pData(monoObj)
kable(table(meta$anno2,meta$State),caption="anno2 and State")
```



### Healthy{.tabset}

```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Aborptive/Sep/TI_epi_reclustered_HealthyorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]+plist[['ec']]
```


### non-Inf {.tabset}

```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Aborptive/Sep/TI_epi_reclustered_adjacent_noorderedMono.rds")

plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]+plist[['ec']]
```



### Inf {.tabset}
```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Aborptive/Sep/TI_epi_reclustered_yesorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]+plist[['ec']]
```

## Secretory {.tabset}

### All cells 


```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Secretory/TI_epi_reclustered_orderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['inf_status']]+plist[['stem']]
plist[['goblet']]+plist[['gotlet1']]

```




### Healthy 


```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Secretory/Sep/TI_epi_reclustered_HealthyorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
plist[['goblet']]+plist[['gotlet1']]

```



### non-Inf 


```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Secretory/Sep/TI_epi_reclustered_adjacent_noorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
plist[['goblet']]+plist[['gotlet1']]

```




### Inf 


```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Secretory/Sep/TI_epi_reclustered_yesorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
plist[['goblet']]+plist[['gotlet1']]

```



## Other {.tabset}

### All cells 

```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Other/TI_epi_reclustered_orderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
```



### Healthy 



```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Other/TI_epi_reclustered_HealthyorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
```


### non-Inf 



```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Other/TI_epi_reclustered_adjacent_noorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
```


### Inf 



```{r, echo=FALSE,warning=FALSE,fig.height=9,fig.width=18}
monoObj=readRDS("../../helmsley/TI_Other/TI_epi_reclustered_yesorderedMono.rds")
plist=plotMonocleResults(monoObj,"absorptive","all")
plist[['anno1']]+plist[['anno2']]
plist[['anno1_v']]+plist[['anno2_v']] 
plist[['stem']]
```